{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [
    {
      "asDropdown": false,
      "icon": "dashboard",
      "includeVars": true,
      "keepTime": true,
      "tags": ["joyce"],
      "targetBlank": false,
      "title": "Joyce Dashboards",
      "type": "dashboards"
    }
  ],
  "liveNow": false,
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 1,
      "panels": [],
      "title": "Error Overview",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "grafana_prometheus" },
      "description": "Error rate percentage",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 2 }, { "color": "red", "value": 5 }] },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 1 },
      "id": 2,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "pluginVersion": "10.2.0",
      "targets": [{
        "expr": "(\n  sum(rate(joyce_errors_total[5m])) /\n  (sum(rate(joyce_requests_total[5m])) > 0)\n) * 100 or vector(0)",
        "refId": "A"
      }],
      "title": "Error Rate (%)",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "grafana_prometheus" },
      "description": "Total errors",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 1 },
      "id": 3,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "pluginVersion": "10.2.0",
      "targets": [{ "expr": "sum(joyce_errors_total) or vector(0)", "refId": "A" }],
      "title": "Total Errors",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "grafana_prometheus" },
      "description": "Authentication failures",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 5 }, { "color": "red", "value": 20 }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 1 },
      "id": 4,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "pluginVersion": "10.2.0",
      "targets": [{ "expr": "sum(joyce_auth_failures_total) or vector(0)", "refId": "A" }],
      "title": "Auth Failures",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "grafana_prometheus" },
      "description": "Rate limit hits",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 10 }, { "color": "red", "value": 50 }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 1 },
      "id": 5,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "pluginVersion": "10.2.0",
      "targets": [{ "expr": "sum(joyce_rate_limit_hits_total) or vector(0)", "refId": "A" }],
      "title": "Rate Limit Hits",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
      "id": 6,
      "panels": [],
      "title": "Error Trends",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "grafana_prometheus" },
      "description": "Errors by type over time",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "bars", "fillOpacity": 100, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "normal" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 6 },
      "id": 7,
      "options": { "legend": { "calcs": ["sum"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "pluginVersion": "10.2.0",
      "targets": [{ "expr": "sum(increase(joyce_errors_total[$__rate_interval])) by (error_type)", "legendFormat": "{{error_type}}", "refId": "A" }],
      "title": "Errors by Type",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "grafana_prometheus" },
      "description": "Auth and rate limit events over time",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Auth Failures" },
            "properties": [{ "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "Rate Limits" },
            "properties": [{ "id": "color", "value": { "fixedColor": "purple", "mode": "fixed" } }]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 6 },
      "id": 8,
      "options": { "legend": { "calcs": ["sum"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "none" } },
      "pluginVersion": "10.2.0",
      "targets": [
        { "expr": "sum(rate(joyce_auth_failures_total[5m]))", "legendFormat": "Auth Failures", "refId": "A" },
        { "expr": "sum(rate(joyce_rate_limit_hits_total[5m]))", "legendFormat": "Rate Limits", "refId": "B" }
      ],
      "title": "Auth & Rate Limit Events",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 14 },
      "id": 9,
      "panels": [],
      "title": "HTTP Status Codes",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "grafana_prometheus" },
      "description": "Request distribution by HTTP status code",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "bars", "fillOpacity": 100, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "normal" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byRegexp", "options": "/2.*/" },
            "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byRegexp", "options": "/4.*/" },
            "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byRegexp", "options": "/5.*/" },
            "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 15 },
      "id": 10,
      "options": { "legend": { "calcs": ["sum"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "pluginVersion": "10.2.0",
      "targets": [{ "expr": "sum(increase(joyce_requests_total[$__rate_interval])) by (status_code)", "legendFormat": "{{status_code}}", "refId": "A" }],
      "title": "Requests by Status Code",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 23 },
      "id": 11,
      "panels": [],
      "title": "Recent Error Logs (from Loki)",
      "type": "row"
    },
    {
      "datasource": { "type": "loki", "uid": "grafana_lokiq" },
      "description": "Recent error and warning logs with trace links",
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 24 },
      "id": 12,
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "prettifyLogMessage": false,
        "showCommonLabels": false,
        "showLabels": false,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": false
      },
      "pluginVersion": "10.2.0",
      "targets": [{
        "expr": "{job=\"joyce-svc\"} | json | level=~\"ERROR|WARNING|WARN\"",
        "refId": "A"
      }],
      "title": "Recent Errors & Warnings",
      "type": "logs"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 34 },
      "id": 13,
      "panels": [],
      "title": "Recent Traces with Errors",
      "type": "row"
    },
    {
      "datasource": { "type": "tempo", "uid": "grafana_tempo" },
      "description": "Recent traces - click to view details",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "custom": { "align": "auto", "cellOptions": { "type": "auto" }, "inspect": false },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Duration" },
            "properties": [{ "id": "unit", "value": "ms" }]
          },
          {
            "matcher": { "id": "byName", "options": "traceID" },
            "properties": [
              {
                "id": "links",
                "value": [{
                  "targetBlank": true,
                  "title": "View Trace",
                  "url": "/explore?left=%7B%22datasource%22:%22tempo%22,%22queries%22:%5B%7B%22refId%22:%22A%22,%22datasource%22:%7B%22type%22:%22tempo%22,%22uid%22:%22tempo%22%7D,%22queryType%22:%22traceql%22,%22query%22:%22${__value.raw}%22%7D%5D%7D"
                }]
              }
            ]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 35 },
      "id": 14,
      "options": { "cellHeight": "sm", "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false }, "showHeader": true },
      "pluginVersion": "10.2.0",
      "targets": [{
        "datasource": { "type": "tempo", "uid": "grafana_tempo" },
        "limit": 20,
        "queryType": "traceqlSearch",
        "refId": "A",
        "tableType": "traces",
        "filters": [
          { "id": "service-name", "operator": "=", "scope": "resource", "tag": "service.name", "value": ["joyce-svc"] }
        ]
      }],
      "title": "Recent Traces",
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 43 },
      "id": 15,
      "panels": [],
      "title": "LLM Errors",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "grafana_prometheus" },
      "description": "LLM timeouts over time",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "bars", "fillOpacity": 100, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "normal" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 44 },
      "id": 16,
      "options": { "legend": { "calcs": ["sum"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "pluginVersion": "10.2.0",
      "targets": [{ "expr": "sum(increase(joyce_llm_timeouts_total[$__rate_interval])) by (model, operation)", "legendFormat": "{{model}} - {{operation}}", "refId": "A" }],
      "title": "LLM Timeouts",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "grafana_prometheus" },
      "description": "LLM timeout rate as percentage of calls",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "line+area" } },
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 10 }, { "color": "red", "value": 20 }] },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 44 },
      "id": 17,
      "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "none" } },
      "pluginVersion": "10.2.0",
      "targets": [{
        "expr": "(\n  sum(rate(joyce_llm_timeouts_total[5m])) /\n  (sum(rate(joyce_llm_calls_total[5m])) > 0)\n) * 100 or vector(0)",
        "legendFormat": "Timeout Rate",
        "refId": "A"
      }],
      "title": "LLM Timeout Rate (%)",
      "type": "timeseries"
    }
  ],
  "refresh": "30s",
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["joyce", "errors", "debugging"],
  "templating": { "list": [] },
  "time": { "from": "now-6h", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "Joyce Errors & Debugging",
  "uid": "joyce-errors",
  "version": 1,
  "weekStart": ""
}
